<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OneSearch URL Testing Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #005daa;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .control-group {
            display: flex;
            flex-direction: column;
        }
        label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        input, select {
            padding: 8px;
            border: 2px solid #005daa;
            border-radius: 3px;
            font-size: 14px;
        }
        button {
            padding: 10px 20px;
            background: #005daa;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        button:hover {
            background: #0076d6;
        }
        .url-output {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 3px;
            font-family: monospace;
            word-break: break-all;
            margin: 10px 0;
        }
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .results-table th, .results-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .results-table th {
            background: #005daa;
            color: white;
        }
        .results-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        .test-link {
            color: #005daa;
            text-decoration: none;
            font-weight: bold;
        }
        .test-link:hover {
            text-decoration: underline;
        }
        .note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>OneSearch URL Testing Tool</h1>

    <div class="note">
        <strong>Note:</strong> This tool generates OneSearch URLs based on the implemented logic.
        Use this to verify that all combinations of resource types and scopes produce correct URLs.
        <br><br>
        <strong>Scope Parameters (Verified):</strong>
        <ul>
            <li><strong>GC:</strong> tab=Everything, search_scope=IZ_CI_AW ✓</li>
            <li><strong>GC & CUNY:</strong> tab=NZPhysical, search_scope=NZPhysical ✓</li>
            <li><strong>GC, CUNY & SUNY:</strong> tab=IZ_NZ_SUNY, search_scope=IZ_CI_AW_NZ_SUNY ✓</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>Single URL Test</h2>
        <div class="test-controls">
            <div class="control-group">
                <label for="testQuery">Search Query:</label>
                <input type="text" id="testQuery" value="test query" placeholder="Enter search term">
            </div>
            <div class="control-group">
                <label for="testSearchType">Search Type:</label>
                <select id="testSearchType">
                    <option value="any">Keyword</option>
                    <option value="title">Title</option>
                    <option value="creator">Author</option>
                    <option value="sub">Subject</option>
                </select>
            </div>
            <div class="control-group">
                <label for="testResourceType">Resource Type:</label>
                <select id="testResourceType">
                    <option value="all">Books, Ebooks & Articles</option>
                    <option value="books">Books</option>
                    <option value="books-ebooks">Books & Ebooks</option>
                    <option value="articles">Articles</option>
                </select>
            </div>
            <div class="control-group">
                <label for="testScope">Search Scope:</label>
                <select id="testScope">
                    <option value="gc">GC</option>
                    <option value="gc-cuny">GC & CUNY</option>
                    <option value="gc-cuny-suny">GC, CUNY & SUNY</option>
                </select>
            </div>
        </div>
        <button onclick="generateSingleURL()">Generate URL</button>
        <div id="singleResult" style="margin-top: 20px;"></div>
    </div>

    <div class="test-section">
        <h2>Generate All Combinations</h2>
        <p>Generate URLs for all possible combinations of Resource Type and Scope (using "test" as query):</p>
        <button onclick="generateAllCombinations()">Generate All Test URLs</button>
        <div id="allResults"></div>
    </div>

    <script>
        function buildURL(query, searchType, resourceType, scope) {
            var baseUrl = "https://cuny-gc.primo.exlibrisgroup.com/discovery/search";
            var vid = "01CUNY_GC:CUNY_GC";

            // Scope mapping - both tab and search_scope change together
            var tabParam;
            var scopeParam;
            switch(scope) {
                case "gc":
                    tabParam = "Everything";
                    scopeParam = "IZ_CI_AW";
                    break;
                case "gc-cuny":
                    tabParam = "NZPhysical";
                    scopeParam = "NZPhysical";
                    break;
                case "gc-cuny-suny":
                    tabParam = "IZ_NZ_SUNY";
                    scopeParam = "IZ_CI_AW_NZ_SUNY";
                    break;
                default:
                    tabParam = "Everything";
                    scopeParam = "IZ_CI_AW";
            }

            // Resource type filters
            var resourceFilters = "";
            switch(resourceType) {
                case "books":
                    resourceFilters = "&mfacet=rtype,include,books,1";
                    break;
                case "books-ebooks":
                    resourceFilters = "&mfacet=rtype,include,books,1&mfacet=rtype,include,book_chapters,1";
                    break;
                case "articles":
                    resourceFilters = "&facet=rtype,exclude,book_chapters&facet=rtype,exclude,books";
                    break;
                case "all":
                default:
                    resourceFilters = "";
                    break;
            }

            // Construct final query URL
            var finalQuery = baseUrl + "?vid=" + vid +
                            "&query=" + searchType + ",contains," + query +
                            "&tab=" + tabParam +
                            "&search_scope=" + scopeParam +
                            "&sortby=rank" +
                            resourceFilters +
                            "&lang=en_US&mode=basic&offset=0";

            return finalQuery;
        }

        function generateSingleURL() {
            var query = document.getElementById('testQuery').value;
            var searchType = document.getElementById('testSearchType').value;
            var resourceType = document.getElementById('testResourceType').value;
            var scope = document.getElementById('testScope').value;

            var url = buildURL(query, searchType, resourceType, scope);

            var resultDiv = document.getElementById('singleResult');
            resultDiv.innerHTML = `
                <h3>Generated URL:</h3>
                <div class="url-output">${url}</div>
                <p><a href="${url}" target="_blank" class="test-link">Test this URL in new tab →</a></p>
            `;
        }

        function generateAllCombinations() {
            var resourceTypes = [
                {value: 'all', label: 'Books, Ebooks & Articles'},
                {value: 'books', label: 'Books'},
                {value: 'books-ebooks', label: 'Books & Ebooks'},
                {value: 'articles', label: 'Articles'}
            ];

            var scopes = [
                {value: 'gc', label: 'GC'},
                {value: 'gc-cuny', label: 'GC & CUNY'},
                {value: 'gc-cuny-suny', label: 'GC, CUNY & SUNY'}
            ];

            var html = '<table class="results-table">';
            html += '<thead><tr><th>Resource Type</th><th>Scope</th><th>Scope Parameter</th><th>Resource Filters</th><th>Test Link</th></tr></thead><tbody>';

            resourceTypes.forEach(function(resource) {
                scopes.forEach(function(scope) {
                    var url = buildURL('test', 'any', resource.value, scope.value);

                    // Extract scope parameter
                    var scopeMatch = url.match(/search_scope=([^&]+)/);
                    var scopeParam = scopeMatch ? scopeMatch[1] : 'N/A';

                    // Extract resource filters
                    var resourceFilter = 'None';
                    if (resource.value === 'books') {
                        resourceFilter = 'mfacet: books';
                    } else if (resource.value === 'books-ebooks') {
                        resourceFilter = 'mfacet: books + book_chapters';
                    } else if (resource.value === 'articles') {
                        resourceFilter = 'facet: exclude books & book_chapters';
                    }

                    html += `<tr>
                        <td>${resource.label}</td>
                        <td>${scope.label}</td>
                        <td><code>${scopeParam}</code></td>
                        <td>${resourceFilter}</td>
                        <td><a href="${url}" target="_blank" class="test-link">Test →</a></td>
                    </tr>`;
                });
            });

            html += '</tbody></table>';

            document.getElementById('allResults').innerHTML = html;
        }
    </script>
</body>
</html>
